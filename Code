#include <SoftwareSerial.h>
SoftwareSerial SIM900(2, 3);
String textForSMS;

int trig = 5;
int echo = 4;
int red =9;
int green = 7;
int yellow = 8;
int buzzer = 11;
int distance;
int time;

void setup() {
  Serial.begin(9600);
  SIM900.begin(9600);
  pinMode(trig, OUTPUT);
  pinMode(echo, INPUT);
  pinMode(buzzer, OUTPUT);
  pinMode(red, OUTPUT);
  pinMode(green, OUTPUT);
  pinMode(yellow, OUTPUT);

}

void loop() {
  digitalWrite(trig, HIGH);
  delayMicroseconds(10);
  digitalWrite(trig, LOW);
  time = pulseIn(echo, HIGH);
  distance = (time * 0.034)/2;


  if(distance<=20){
    textForSMS =  "INTRUDER ALERT";
    digitalWrite(red, HIGH);
    digitalWrite(green, LOW);
    digitalWrite(yellow, LOW);
    digitalWrite(buzzer, HIGH);
    sendSMS(textForSMS);
    Serial.println(textForSMS);
    Serial.println("message sent.");
    delay(500);
  }
  if((distance>20) && (distance<=50)){
    digitalWrite(yellow, HIGH);
    digitalWrite(red, LOW);
    digitalWrite(green, LOW);
  }
  if (distance>50){
    digitalWrite(green, HIGH);
    digitalWrite(red, LOW);
    digitalWrite(yellow, LOW);
  }
  else{
    digitalWrite(buzzer, LOW);
    delay(500);
  }

}


void sendSMS(String message)
{
  SIM900.print("AT+CMGF=1\r");                     // AT command to send SMS message
  delay(1000);
  SIM900.println("AT + CMGS = \"+919908310707\"");  // recipient's mobile number, in international format

  delay(1000);
  SIM900.println("INTRUDER ALERT");                         // message to send

  SIM900.println((char)26);                        // End AT command with a ^Z, ASCII code 26
  delay(1000);
  SIM900.println();
  // give module time to send SMS

}
